(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{113:function(e,n){},115:function(e,n){},132:function(e,n,r){"use strict";r.r(n);var t=r(0),c=r.n(t),o=r(69),a=r.n(o),u=(r(79),r(74)),i=r(2),s=r(134),f=r(1),l=function(e){return Object(f.jsx)("button",{onClick:function(){var n=Object(s.a)();e.history.push("/room/".concat(n))},children:"Create room"})},d=r(25),j=r.n(d),p=r(43),h=r(36),b=r(29),v=r(37),O=r(70),g=r.n(O),k=r(39),m=r(38),x=r.n(m);function T(e,n,r,t){var c=new x.a({initiator:!0,trickle:!1});return c.on("signal",(function(r){t.current.emit("offer",{userToSignal:e,callerID:n,data:r})})),c}function D(e,n,r,t){var c=new x.a({initiator:!1,trickle:!1});return c.on("signal",(function(e){t.current.emit("answer",{data:e,callerID:n})})),c.signal(e),c}var I,w,y=function(e){var n=e.audio,r=e.video,t=e.leaveRoom,c=e.shareScreen;return Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:function(){return function(e){e&&e.audioTracks&&e.audioTracks.forEach((function(e){return e.enabled=!e.enabled}))}(n)},children:"Mute"}),Object(f.jsx)("button",{onClick:function(){return function(e){e&&e.videoTracks&&e.videoTracks.forEach((function(e){return e.enabled=!e.enabled}))}(r)},children:"Video"}),Object(f.jsx)("button",{onClick:function(){return t()},children:"Leave"}),Object(f.jsx)("button",{onClick:function(){return c()},children:"Share Screen"})]})},E=k.a.div(I||(I=Object(v.a)(["\n  padding: 20px;\n  display: flex;\n  height: 100vh;\n  width: 90%;\n  margin: auto;\n  flex-wrap: wrap;\n"]))),S=k.a.video(w||(w=Object(v.a)(["\n  height: 40%;\n  width: 50%;\n"]))),C=function(e){var n=Object(t.useRef)();return Object(t.useEffect)((function(){e.peer.on("stream",(function(e){n.current.srcObject=e}))}),[]),Object(f.jsx)(S,{playsInline:!0,autoPlay:!0,ref:n})},R={audio:{echoCancellation:!0},video:{width:{min:1280},height:{min:720}}},P=function(e){var n=Object(t.useState)([]),r=Object(b.a)(n,2),c=r[0],o=r[1],a=Object(t.useState)({}),u=Object(b.a)(a,2),i=u[0],s=u[1],l=Object(t.useState)({}),d=Object(b.a)(l,2),v=d[0],O=d[1],k=Object(t.useRef)(),m=Object(t.useRef)(),x=Object(t.useRef)([]),I=Object(t.useRef)([]);Object(t.useEffect)((function(){var n=e.match.params.roomID;(function(){var e=Object(h.a)(j.a.mark((function e(){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.current=g.a.connect("/"),e.next=3,navigator.mediaDevices.getUserMedia(R);case 3:r=e.sent,m.current.srcObject=r,s({isMuted:!1,audioTracks:r.getAudioTracks()}),O({isOn:!0,videoTracks:r.getVideoTracks()}),k.current.emit("join-room",n),k.current.on("room-full",(function(){return console.log("Sorry the room is full!")})),k.current.on("all-users",(function(e){var n=[];e.forEach((function(e){var t=T(e,k.current.id,0,k);try{r.getTracks().forEach((function(e){return x.current.push(t.addTrack(e,r))}))}catch(c){console.log("Error in createPeer: ".concat(c))}I.current.push({peerID:e,peer:t}),n.push({peerID:e,peer:t})})),o(Object(p.a)(I.current))})),k.current.on("user-joined",(function(e){var n=D(e.data,e.callerID,0,k);try{r.getTracks().forEach((function(e){return x.current.push(n.addTrack(e,r))})),console.log("userVideoTracks: ".concat(x))}catch(t){console.log("Error in addPeer: ".concat(t))}I.current.push({peerID:e.callerID,peer:n}),o(Object(p.a)(I.current))})),k.current.on("receiving-answer",(function(e){I.current.find((function(n){return n.peerID===e.id})).peer.signal(e.data)})),k.current.on("user-left",(function(e){var n=I.current.find((function(n){return n.peerID===e}));n&&n.peer.destroy();var r=I.current.filter((function(n){return n.peerID!==e}));I.current=r,o(r)}));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var w=function(){var e=Object(h.a)(j.a.mark((function e(){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({cursor:!0});case 3:n=e.sent,r=n.getTracks()[0],console.log(x),x.current.find((function(e){return"video"===e.track.kind})).replaceTrack(r),r.onended=function(){return x.current.find((function(e){return"video"===e.track.kind})).replaceTrack(m.current.srcObject.getTracks()[1])},e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();return Object(f.jsxs)(E,{children:[Object(f.jsx)(S,{muted:!0,ref:m,autoPlay:!0,playsInline:!0}),c.map((function(e){return Object(f.jsx)(C,{peer:e.peer},e.peerID)})),Object(f.jsx)(y,{audio:i,video:v,leaveRoom:function(){m.current.srcObject.getTracks().forEach((function(e){return e.stop()})),I.current=null,o(I.current),k.current.disconnect(),e.history.push("/")},shareScreen:w})]})};var M=function(){return Object(f.jsx)(u.a,{children:Object(f.jsxs)(i.c,{children:[Object(f.jsx)(i.a,{path:"/",exact:!0,component:l}),Object(f.jsx)(i.a,{path:"/room/:roomID",component:P})]})})},F=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,135)).then((function(n){var r=n.getCLS,t=n.getFID,c=n.getFCP,o=n.getLCP,a=n.getTTFB;r(e),t(e),c(e),o(e),a(e)}))};a.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(M,{})}),document.getElementById("root")),F()},79:function(e,n,r){}},[[132,1,2]]]);
//# sourceMappingURL=main.cd26193a.chunk.js.map